<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<PropertyGroup Label="UserMacros">
		<!-- selector for debug/release version -->
		<IsDebug>$([System.Convert]::ToString( $([System.Text.RegularExpressions.Regex]::IsMatch($(Configuration), '[Dd]ebug'))))</IsDebug>
		<IsRelease>$([System.Convert]::ToString( $([System.Text.RegularExpressions.Regex]::IsMatch($(Configuration), '[Rr]elease'))))</IsRelease>

		<!-- variable contains max version -->
		<MaxVersion Condition="'$(Configuration.Contains(2013))'">2013</MaxVersion>
		<MaxVersion Condition="'$(Configuration.Contains(2014))'">2014</MaxVersion>
		<MaxVersion Condition="'$(Configuration.Contains(2015))'">2015</MaxVersion>

		<!-- version specific path selectors -->
		<MaxPath Condition="'$(MaxVersion)'=='2013' and '$(Platform)'=='x64'">$(ADSK_3DSMAX_x64_2013)</MaxPath>
		<MaxPath Condition="'$(MaxVersion)'=='2014' and '$(Platform)'=='x64'">$(ADSK_3DSMAX_x64_2014)</MaxPath>
		<MaxPath Condition="'$(MaxVersion)'=='2015' and '$(Platform)'=='x64'">$(ADSK_3DSMAX_x64_2015)</MaxPath>

		<MaxSDKPath Condition="'$(MaxVersion)'=='2014'">$(FABRIC_SCENE_GRAPH_DIR)\ThirdParty\PreBuilt\Windows\x86_64\Release\3dsmax\3ds Max 2014 SDK\</MaxSDKPath>
		<MaxSDKPath Condition="'$(MaxVersion)'=='2015'">$(FABRIC_SCENE_GRAPH_DIR)\ThirdParty\PreBuilt\Windows\x86_64\Release\3dsmax\3ds Max 2015 SDK\</MaxSDKPath>

	</PropertyGroup>
	
	<!-- General properties for everyone -->
	<PropertyGroup Label="Configuration">
		<UseOfMfc>false</UseOfMfc>
		<UseOfAtl>false</UseOfAtl>
		<PlatformToolset>v100</PlatformToolset>
		<IsUnicode>true</IsUnicode>
		<CharacterSet>Unicode</CharacterSet>

		<IntDir>build\FabricSplice3dsmax\obj\$(Configuration)\</IntDir>
		<OutDir>$(FABRIC_DIR)\SpliceIntegrations\FabricSplice3dsmax$(MaxVersion)\plugin\</OutDir>
		<TargetExt>.dlu</TargetExt>
		<ConfigurationType>DynamicLibrary</ConfigurationType>
		<UseDebugLibraries>false</UseDebugLibraries>
    <PreprocessorDefinitions>FEC_STATIC;FECS_SHARED;%(PreprocessorDefinitions)</PreprocessorDefinitions>
	</PropertyGroup>
	<PropertyGroup Condition="!'$(IsUnicode)'" Label="Configuration">
		<CharacterSet>MultiByte</CharacterSet>
	</PropertyGroup>

	<ItemDefinitionGroup>
		<!-- default values for compiler -->
		<ClCompile>
			<AdditionalIncludeDirectories>$(FABRIC_DIR)\include;$(MaxSDKPath)\maxsdk\include;%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>
			<WarningLevel>Level4</WarningLevel>
			<RuntimeTypeInfo>true</RuntimeTypeInfo>
			<StringPooling>true</StringPooling>
      		<PrecompiledHeader>Use</PrecompiledHeader>
			<DebugInformationFormat>ProgramDatabase</DebugInformationFormat>
     		<PreprocessorDefinitions>FEC_STATIC;%(PreprocessorDefinitions)</PreprocessorDefinitions>
		</ClCompile>

		<!-- Turn on E&C for Debug Win32 builds -->
		<ClCompile Condition="'$(IsDebug)'">
			<DebugInformationFormat>EditAndContinue</DebugInformationFormat>
			<WholeProgramOptimization>false</WholeProgramOptimization>
			<SDLCheck>true</SDLCheck>
			<Optimization>Disabled</Optimization>
			<PreprocessorDefinitions>_DEBUG;_ITERATOR_DEBUG_LEVEL=0;%(PreprocessorDefinitions)</PreprocessorDefinitions>
			<RuntimeLibrary>MultiThreadedDebug</RuntimeLibrary>
		</ClCompile>
		
		<!-- Release specific compiler settings -->
		<ClCompile Condition="'$(IsRelease)'">
			<Optimization>MaxSpeed</Optimization>
			<IntrinsicFunctions>true</IntrinsicFunctions>
			<FavorSizeOrSpeed>speed</FavorSizeOrSpeed>
			<PreprocessorDefinitions>NDEBUG;%(PreprocessorDefinitions)</PreprocessorDefinitions>
			<FunctionLevelLinking>true</FunctionLevelLinking>
			<WholeProgramOptimization>true</WholeProgramOptimization>
			<RuntimeLibrary>MultiThreaded</RuntimeLibrary>
		</ClCompile>
		
		<!-- Linker Common Settings -->
		<Link>
			<LinkIncremental>true</LinkIncremental>
			<GenerateDebugInformation>true</GenerateDebugInformation>
			<SubSystem>Windows</SubSystem>
			<AdditionalDependencies>FabricCore-1.14.lib;FabricSplice-1.14_s.lib;assetmanagement.lib;atscore.lib;biped.lib;bmm.lib;core.lib;crowd.lib;custdlg.lib;databridge.lib;edmodel.lib;expr.lib;flt.lib;geom.lib;gfx.lib;GraphicsDriver.lib;gup.lib;igame.lib;imageviewers.lib;manipsys.lib;maxnet.lib;maxscrpt.lib;maxutil.lib;menuman.lib;menus.lib;mesh.lib;mnmath.lib;paramblk2.lib;particle.lib;particleflow.lib;physique.lib;poly.lib;polypaint.lib;renderutil.lib;rtmax.lib;tessint.lib;viewfile.lib;zlibdll.lib;%(AdditionalDependencies)</AdditionalDependencies>
			<AdditionalDependencies Condition="'$(MaxVersion)'!='2012'">GraphicsUtility.lib;%(AdditionalDependencies)</AdditionalDependencies>
			<AdditionalLibraryDirectories>$(FABRIC_DIR)\lib;$(BOOST_DIR);$(MaxSDKPath)\maxsdk\lib\x64\Release\</AdditionalLibraryDirectories>
		</Link>

		<!-- 2014 very helpfully changed the installed path -->
		<Link Condition="'$(MaxVersion)' &gt; '2013'">
			<AdditionalLibraryDirectories>$(MaxSDKPath)\lib\x64\Release\;%(AdditionalLibraryDirectories)</AdditionalLibraryDirectories>
		</Link>
	</ItemDefinitionGroup>
	<ImportGroup Label="PropertySheets">
		<Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
		<Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
		<Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
	</ImportGroup>

  <!-- Override the MS props file settings -->
  <PropertyGroup>
    <TargetExt>.dlo</TargetExt>
  </PropertyGroup>

  <ItemDefinitionGroup>
    <PostBuildEvent>
      <Command>copy "$(ProjectDir)3dsMax2014.bat" "$(FABRIC_DIR)SpliceIntegrations/FabricSplice3dsmax$(MaxVersion)/" /Y
copy "$(ProjectDir)SetupMenu.ms" "$(FABRIC_DIR)SpliceIntegrations/FabricSplice3dsmax$(MaxVersion)/" /Y
xcopy "$(ProjectDir)ScintillaNET" "$(FABRIC_DIR)SpliceIntegrations/FabricSplice3dsmax$(MaxVersion)/ScintillaNET" /E /I /Y
xcopy "$(ProjectDir)testingScripts" "$(FABRIC_DIR)SpliceIntegrations/FabricSplice3dsmax$(MaxVersion)/samples" /E /I /Y
call "$(ProjectDir)/GeneratePluginIni.bat" "$(TargetDir)"
      </Command>
    </PostBuildEvent>
  </ItemDefinitionGroup>
  <PropertyGroup>
    <LocalDebuggerCommandArguments>-vo -p "$(ProjectDir)/build/Generated.Plugin.Splice.ini"</LocalDebuggerCommandArguments>
    <LocalDebuggerCommand>$(MaxPath)3dsmax.exe</LocalDebuggerCommand>
  </PropertyGroup>
</Project>
